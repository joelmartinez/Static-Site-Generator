<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf8" />
	<title>Determining &quot;place&quot; Location by Averaging User Data</title>
  <meta name="author" content="Joel Martinez" />
  <meta name="nlweb:ai-access" content="allow" />
  <link rel="alternate" type="application/rss+xml" title="Determining &quot;place&quot; Location by Averaging User Data" href="//codecube.net/feed/" />
  <link rel="nlweb-manifest" href="/nlweb.json" />
	<link rel="stylesheet" type="text/css" href="/design/style.css?v=2" />
      <meta name="title" content="Determining &quot;place&quot; Location by Averaging User Data" />
      <meta name="description" content="Location based services like foursquare, gowalla, and the recently minted &#x27;facebook places&#x27; let users check in from wherever they are at to inform their friends of their whereabouts. By this point,..." />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:site" content="@joelmartinez" />
      <meta name="twitter:creator" content="@joelmartinez" />
      <meta name="twitter:title" content="Determining &quot;place&quot; Location by Averaging User Data" />
      <meta name="twitter:description" content="Location based services like foursquare, gowalla, and the recently minted &#x27;facebook places&#x27; let users check in from wherever they are at to inform their friends of their whereabouts. By this point,..." />
      <meta property="og:type" content="article" />
      <meta property="og:title" content="Determining &quot;place&quot; Location by Averaging User Data" />
      <meta property="og:description" content="Location based services like foursquare, gowalla, and the recently minted &#x27;facebook places&#x27; let users check in from wherever they are at to inform their friends of their whereabouts. By this point,..." />
      <meta name="twitter:image" content="http://upload.wikimedia.org/math/9/1/6/916178b5822b7f7ae920bad7e871d1db.png" />
      <meta property="og:image" content="http://upload.wikimedia.org/math/9/1/6/916178b5822b7f7ae920bad7e871d1db.png" />
      <meta name="image" content="http://upload.wikimedia.org/math/9/1/6/916178b5822b7f7ae920bad7e871d1db.png" />
  
  <script src="/script/tone.js"></script>
</head>
<body>
  <div id="header">
    <div>
	  <a href="/" rel="home"><img height="50" width="50" src="//www.gravatar.com/avatar/a61a4be80ce39683142620a76299820b.png" title="ItsAMeee" /></a>
      <a href="/about/" rel="author">Joel Martinez</a>
      <a href="/resume/">Resume</a>

      <img id="flair" src="/design/images/flair.png" />
    </div>
  </div>

  <div id="contentwrapper">
	  <div id="content">
		<article class="hentry" itemscope itemtype="https://schema.org/Article">
  <h1 class="entry-title" itemprop="headline">Determining &quot;place&quot; Location by Averaging User Data</h1>
  <p id="author">By <a href="http://codecube.net" title="More posts by Joel Martinez" rel="author" itemprop="author" itemscope itemtype="https://schema.org/Person"><span itemprop="name">Joel Martinez</span></a> on <time class="published" itemprop="datePublished" datetime="2010-12-28">12/28/2010</time>
</p>
  <div class="entry-content" itemprop="articleBody">
    Location based services like foursquare, gowalla, and the recently minted 'facebook places' let users check in from wherever they are at to inform their friends of their whereabouts. By this point, most places have already been defined in those services, so all you usually have to do is pick from a list of nearby locations. And if it's not on the list, you can just define a new place.<br /><br />Despite the social weight of these already existing services ... there is still a lush breeding grounds for innovation in location services. If you were building such a service, let's talk about the process of defining a "new place" as a user. What happens if the first user of your app to create a place is actually just around the corner, or if the place is large enough, on the east side rather than the west side. In a naively designed system, your place would be incorrectly defined from that point forward and would offer incorrect position data for the life of your service.<br /><br />This post proposes a simple system that lets the place's location in the world adjust itself over time. The more checkins you receive, the more accurate the location.<br /><br />The concept is quite simple actually, by <a href="http://en.wikipedia.org/wiki/Centroid#Of_a_finite_set_of_points">computing the centroid</a> from all known checkins, you find the true 'center' of you place.Â Doing this calculation could not be any simpler, centroid is just a fancy term for the average vector from a set (ie. Lat/Lon)<br /><br /><img class="alignnone" title="formula" src="http://upload.wikimedia.org/math/9/1/6/916178b5822b7f7ae920bad7e871d1db.png" alt="" width="199" height="39" /><br /><br />I made a useful extension method that you can apply to a collection of vectors which can be invoked as such.
<blockquote>
<pre>Vector2 centroid = locations.Centroid();<br /><br />public static class VectorExtensions
{
    public static Vector2 Centroid(this List&lt;Vector2&gt; points)
    {
        int pointCount = points.Count;
        Vector2 total = Vector2.Zero;
        Vector2 centroid = Vector2.Zero;<br /><br />        if (pointCount &gt; 0)
        {
            for (int i = 0; i &lt; pointCount; i++)
            {
                var point = points[i];
                total.X += point.X;
                total.Y += point.Y;
            }
            centroid = new Vector2(
                total.X / (float)pointCount,
                total.Y / (float)pointCount);
        }
        return centroid;
    }
}</pre>
</blockquote>
So given a set of points, this would easily give you the logical center of them. Even if there's a random checkin from outside the area, the average will not let the centroid vary by much.<br /><br /><img class="aligncenter size-full wp-image-387" title="centroid" src="http://codecube.net/wp-content/uploads/2010/08/centroid.png" alt="" width="374" height="240" /><br /><br />But there is still an issue with this approach. How can this techique be applied to a real world system, you can't expect me to keep a copy of every checkin ever done for a given location ... I mean you can, but for most purposes it's overkill.<br /><br />Luckily, there is a way to reduce the problem domain to limit the amount of data needed to recalculate the centroid every time there is a new point to consider. By doing a weighted average, your data structure is greatly simplified because all you have to keep in the database for any given location is:
<ul>
	<li>latitude</li>
	<li>longitude</li>
	<li>numberOfCheckins</li>
</ul>
With that, you can find your list of closest places to let the user see if their location is already in the db.<br /><br />If the user selects an existing place to check in to, you can calc the centroid as follows:
<blockquote>
<pre>public static Vector2 WeightedCentroid(
                                                this Vector2 newPoint,
                                                Vector2 oldCentroid,
                                                int numOfCheckins)
{
    return new Vector2(
        (oldCentroid.X * (float)numOfCheckins + newPoint.X) / ((float)numOfCheckins + 1),
        (oldCentroid.Y * (float)numOfCheckins + newPoint.Y) / ((float)numOfCheckins + 1)
        );
};</pre>
</blockquote>
With that, you can save the value of the new average, along with the latest number of checkins. And that's it!
  </div>
</article>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Determining \&quot;place\&quot; Location by Averaging User Data",
  "description": "Location based services like foursquare, gowalla, and the recently minted &#x27;facebook places&#x27; let users check in from wherever they are at to inform their friends of their whereabouts. By this point,...",
  "author": {
    "@type": "Person",
    "name": "Joel Martinez",
    "url": "https://codecube.net/about/"
  },
  "publisher": {
    "@type": "Person",
    "name": "Joel Martinez",
    "url": "https://codecube.net"
  },
  "datePublished": "2010-12-28",
  "dateModified": "2010-12-28",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://codecube.net/2010/12/determining-place-location-by-averaging-user-data/"
  }
}
</script>
<p>See more in the <a href="/#archives">archives</a>
</p>

	  </div>
  </div>

  <div id="footer">
    copyright 2013 - 2025 - <a rel="me" href="https://mastodon.social/@joelmartinez">me @ Mastodon</a> and <a rel="me" href="https://www.threads.net/@joeldm1971">Threads</a>
  </div>

  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WV9DDDSFMW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WV9DDDSFMW');
</script>
</body>
</html>
